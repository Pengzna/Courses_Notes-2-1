# PAè¯¾ç¬”è®°

## 		PA_1-1

![image-20210910101403078](C:\Users\86186\AppData\Roaming\Typora\typora-user-images\image-20210910101403078.png)

æŠŠreg.hä¸­çš„ä¸Šé¢ä¸‰ä¸ªstructæ”¹ä¸ºunionå³å¯

![image-20210910101447994](C:\Users\86186\AppData\Roaming\Typora\typora-user-images\image-20210910101447994.png)

â€‹	æ³¨æ„ï¼šåœ¨æ¯æ¬¡æ”¹å®Œå¤´æ–‡ä»¶æˆ–è€…é…ç½®æ–‡ä»¶ä¹‹åï¼Œéƒ½è¦make cleanä¸€ä¸‹

## 	PA_1-2



![image-20210910102408344](PAè¯¾ç¬”è®°.assets/image-20210910102408344.png)

â€‹	-å¯¹äºADCçš„CFï¼šåˆ†ä¸ºCF=0æˆ–CF=1ä¸¤ç§æƒ…å†µåˆ¤æ–­ï¼ˆæ­¤å¤„å‚ä¸è¿ç®—çš„CFæ˜¯ä¸Šä¸€æ¡æŒ‡ä»¤ç•™ä¸‹çš„CFï¼Œç„¶åADCå†é‡æ–°è®¾ç½®CFï¼‰

ä¸è¿‡CF=1çš„æ—¶å€™éœ€è¦é¢å¤–è€ƒè™‘ä¸€ç§æƒ…å½¢ï¼šres = srcçš„æ—¶å€™ä¹Ÿäº§ç”Ÿè¿›ä½ï¼ˆæ­¤æ—¶des = 0xFFF...ï¼‰

å…¶ä½™æƒ…å†µçœ‹res < src?å³å¯



â€‹	-å¯¹äºSUBï¼Œå¯ä»¥å–å‡æ•°çš„è¡¥ç åšåŠ æ³•ï¼Œæ­¤æ—¶ä¸èƒ½æŒ‰ç…§åŠ æ³•çš„é€»è¾‘åˆ¤CFï¼Œå› ä¸ºå‡æ³•æ˜¯åœ¨è¡¨ç›˜ä¸Šé€†æ—¶é’ˆè¿ç®—ã€‚

## PA_1-3

4-3å¯èƒ½è¿˜ä¼šç¢°åˆ°æ²¡æœ‰å®ç°çš„æµ®ç‚¹æ•°æŒ‡ä»¤ï¼Œåˆ™éœ€è¦çœ‹ç½‘ç«™è‡ªå·±å®ç°

ä»¥32ä½å•ç²¾åº¦çš„IEEE 754ä¸ºç›®æ ‡æ¨¡æ‹Ÿ

ä¸å¸¦éšè—ä½çš„å°¾æ•°ï¼šfraction

å¸¦éšè—ä½çš„å°¾æ•°ï¼šsignificand

![image-20210918154659835](PAè¯¾ç¬”è®°.assets/image-20210918154659835.png)

ç»“æ„ä½“é‡Œï¼Œå†™åœ¨ä¸Šé¢çš„æ˜¯ä½åœ°å€éƒ¨åˆ†

![image-20210918154938708](PAè¯¾ç¬”è®°.assets/image-20210918154938708.png)

åœ¨æœºå™¨æ•°çš„åŸºç¡€ä¸Šï¼Œå®ç°æµ®ç‚¹æ•°çš„ç›¸å…³è¿ç®—![image-20210918155243919](PAè¯¾ç¬”è®°.assets/image-20210918155243919-16319515649351.png)

æ³¨æ„ï¼šå‡½æ•°ä¼ è¿›æ¥çš„å‚æ•°æ˜¯æœºå™¨æ•°ï¼



æ¡†æ¶ä»£ç å·²ç»å¤„ç†å¥½äº†æ‰€æœ‰çš„è¾¹ç•Œæƒ…å†µï¼ŒåŒ…æ‹¬NaNã€0ã€INF

ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨å¤„ç†æµ®ç‚¹æ•°çš„æ—¶å€™åªéœ€è¦åˆ¤æ–­éè§„åˆ’åŒ–æ•°å’Œè§„æ ¼åŒ–æ•°å³å¯ã€‚

ä½æˆ–ï¼š| = ç›®çš„æ˜¯åŠ ä¸Šimplided bit



### æµ®ç‚¹æ•°åšåŠ å‡æ³•çš„æ­¥éª¤ï¼š

1. å¯¹é˜¶ï¼šå°é˜¶å‘å¤§é˜¶çœ‹é½

   å°é˜¶å¢åŠ è‡³å¤§é˜¶ï¼ŒåŒæ—¶å°¾æ•°å³ç§»ï¼Œä¿è¯å¯¹åº”çœŸå€¼ä¸å˜

   ä½†æ˜¯æ³¨æ„æ­¤å¤„è¦è€ƒè™‘éè§„æ ¼åŒ–æ•°çš„æƒ…å½¢

2. å°¾æ•°ç›¸åŠ ï¼ˆç›¸å‡ï¼‰



![image-20210928113701469](PAè¯¾ç¬”è®°.assets/image-20210928113701469.png)

åŒæ—¶è¦åŠ å…¥ä¿æŠ¤ä½Gã€Rã€Sï¼Œå› æ­¤æ­¤æ—¶å°¾æ•°æœ‰23 + 3 = 26ä½

æ³¨æ„ï¼šstickyï¼ˆç²˜ä½ï¼‰è¡¨ç¤ºçš„æ˜¯åœ¨å®ƒæ›´ä½çš„ä½ç½®æ˜¯å¦æœ‰1ï¼Œä¸€æ—¦æœ‰1å‡ºç°ï¼Œå°±è¢«é»ä½ã€‚

å³ä¸€æ—¦æœ‰1è¢«ç§»å‡ºäº†sï¼Œså°±æ°¸è¿œä¸º1



å¾—åˆ°ä¸­é—´ç»“æœåè¿›è¡Œè§„æ ¼åŒ–å’Œèˆå…¥æ“ä½œï¼Œå¾—åˆ°ç¬¦åˆIEEE 754æ ‡å‡†çš„æ•°å­—

![image-20210928132142927](PAè¯¾ç¬”è®°.assets/image-20210928132142927.png)

ä¹˜é™¤æ³•å¯èƒ½å‡ºç°ç»“æœä¸ºè´Ÿçš„é˜¶ç 



### è§„æ ¼åŒ–

ä¸¤æ­¥ï¼šå…ˆè½¬åŒ–ä¸º1.xxxx * é˜¶ç çš„æ“ä½œï¼ˆå³è§„orå·¦è§„ï¼‰ï¼Œå†ç æ‰grs

![image-20210928133425339](PAè¯¾ç¬”è®°.assets/image-20210928133425339.png)

![image-20210928133723932](PAè¯¾ç¬”è®°.assets/image-20210928133723932.png)

![image-20210928134451576](PAè¯¾ç¬”è®°.assets/image-20210928134451576.png)

å¦‚æœexpåŠ è¿‡äº†å¤´ï¼Œä»¤exp = 0xFFï¼Œå°¾æ•° = 0ï¼ˆåœ¨IEEE 754ä¸­è¡¨ç¤ºINFï¼‰

æ³¨ï¼šé™¤äº†è€ƒè™‘è§„æ ¼åŒ–æ•°å˜ä¸ºéè§„æ ¼åŒ–æ•°ï¼Œè¿˜è¦è€ƒè™‘éè§„æ ¼åŒ–æ•°å˜ä¸ºè§„æ ¼åŒ–æ•°



### èˆå…¥

![image-20210928134525969](PAè¯¾ç¬”è®°.assets/image-20210928134525969.png)



## PA_2-0

game kernel testcase éƒ½æ˜¯è½¯ä»¶

nemu ä¸ºæ¨¡æ‹Ÿè®¡ç®—æœº

æ³¨ï¼š åæ–œæ çš„æ„æ€æ˜¯æ¢è¡Œ

![image-20211006212944133](PAè¯¾ç¬”è®°.assets/image-20211006212944133.png)



***gcc -o hello_world hello_world.c ä¸€æ¡å‘½ä»¤æ‰§è¡Œäº†å››ä¸ªæ­¥éª¤***ï¼š

### .i  é¢„å¤„ç† Proprocess 

- gcc -E -oï¼ˆè¡¨ç¤ºæŒ‡å®šè¾“å‡ºï¼‰ add.i add.c : è¡¨ç¤ºå¯¹.cæ–‡ä»¶è¿›è¡Œé¢„å¤„ç†

- å±•å¼€#inlcludeå¤´æ–‡ä»¶çš„å†…å®¹ã€æŠŠå¤´æ–‡ä»¶å†…å®¹æ‹·è´åˆ°.iæ–‡ä»¶ä¸­ã€‘
- å±•å¼€å®å®šä¹‰ã€æŠŠæºç¨‹åºï¼ˆ.cï¼‰æ–‡ä»¶ä¸­çš„å®è¯­å¥æ›¿æ¢æˆå®å®šä¹‰ã€‘

### .S ç¼–è¯‘ Compile

- gcc -S -o add.S add.i
- ç¼–è¯‘æ˜¯æŠŠCè¯­è¨€ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€
- æ¯”è¾ƒå›°éš¾

### -c æ±‡ç¼– Assemble

- å°†æ±‡ç¼–è¯­è¨€è½¬å˜æˆæœºå™¨è¯­è¨€ç¨‹åºï¼ˆ.oæ–‡ä»¶ï¼‰
- å¦‚æœæƒ³æŸ¥çœ‹ -o æ–‡ä»¶ï¼Œåˆ™éœ€è¦ç”¨objdumpåæ±‡ç¼–å·¥å…·è¿›è¡ŒæŸ¥çœ‹
  - objdump4nemu-i386 -dï¼ˆè¡¨ç¤ºåšåæ±‡ç¼–ï¼‰ add.o > add.obj
- æ¯”è¾ƒç®€å•
- gcc -c

### é“¾æ¥ link



### Hello World æ±‡ç¼–ç¨‹åºç¤ºä¾‹

![image-20211007203452973](PAè¯¾ç¬”è®°.assets/image-20211007203452973.png)

hello_strå‰é¢åŠ $ç¬¦å·è¡¨ç¤ºè¯¥å˜é‡çš„åœ°å€

ç¨‹åºçš„å…¥å£å°±æ˜¯.globl main -- é“¾æ¥å™¨éœ€è¦å®ƒ



### æ±‡ç¼–è¯­è¨€çš„æ ¼å¼

â€‹	gccæ¥å—çš„æ ¼å¼ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å†™ç¨‹åºé‡‡ç”¨çš„æ ¼å¼

#### AT&Tæ ¼å¼ï¼ˆobjdumpæ˜¾ç¤ºçš„æ ¼å¼ï¼‰ï¼š

![image-20211007203837553](PAè¯¾ç¬”è®°.assets/image-20211007203837553.png)

#### INTELæ ¼å¼ï¼ˆi386æ‰‹å†Œä¸Šé‡‡ç”¨çš„æ ¼å¼ï¼‰

![image-20211007203908682](PAè¯¾ç¬”è®°.assets/image-20211007203908682.png)

- æ³¨æ„ï¼šä¸­é—´æœ‰é€—å·
- AT&Tæ˜¯å°å†™ï¼ŒINTELæ˜¯å¤§å†™



#### é•¿åº¦åç¼€

![image-20211007204354656](PAè¯¾ç¬”è®°.assets/image-20211007204354656.png)

#### æ“ä½œæ•°å¯»å€

- è¯¾æœ¬P93 

![image-20211007205232004](PAè¯¾ç¬”è®°.assets/image-20211007205232004.png)

- å¦‚æœæ“ä½œæ•°åœ¨å†…å­˜ä¸­ï¼Œæ•°å­—å‰é¢æ˜¯æ²¡æœ‰$çš„



#### ä¸€ä¸ªå°ç»ƒä¹ 

- åœ¨å†…å­˜é‡Œé¢æ±‚è§£æ–æ³¢é‚£å¥‘

![image-20211007210130442](PAè¯¾ç¬”è®°.assets/image-20211007210130442.png)



### ä½¿ç”¨gdbè°ƒè¯•ç¨‹åº

- è°ƒè¯•æŸç¨‹åºï¼šgdb <ç¨‹åºå> 
  - eg: gbd nemu
- ![image-20211007210408226](PAè¯¾ç¬”è®°.assets/image-20211007210408226.png)
- q ï¼ˆquitï¼‰é€€å‡º

#### ä½¿ç”¨monitorï¼ˆnemuå†…ç½®è°ƒè¯•å™¨ï¼‰è°ƒè¯•ç¨‹åº

![image-20211007212203344](PAè¯¾ç¬”è®°.assets/image-20211007212203344.png)

- ä¹Ÿå¯ä»¥ç”¨gdbç›´æ¥è°ƒè¯•nemuï¼Œè°ƒç”¨make debug
  - è§PA_2-0 å½•æ’­ æœ€å10åˆ†é’Ÿç¤ºä¾‹



## PA_2-1

### å¤§è‡´æ¢è®¨

![image-20211007235939920](PAè¯¾ç¬”è®°.assets/image-20211007235939920.png)

![image-20211008000100445](PAè¯¾ç¬”è®°.assets/image-20211008000100445.png)



ç¬¬ä¸€æ­¥ï¼šè£…è½½ï¼ˆ2-1ç®€å•å®ç°ï¼Œ2-2æ·±å…¥æ¢è®¨ï¼‰

- EIPå¯„å­˜å™¨å³ä¸ºPCï¼Œ è£…è½½æ—¶åˆå§‹åŒ–ä¸º0x300000
- ESPå¯„å­˜å™¨å³ä¸ºå½“å‰çš„æ ˆé¡¶ï¼ŒæŒ‡å‘å†…å­˜çš„æœ«å°¾0x7FFFFFF
  - æ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€æ¶¨

ç¬¬äºŒæ­¥ï¼šæ‰§è¡ŒæŒ‡ä»¤

- ![image-20211008153232967](PAè¯¾ç¬”è®°.assets/image-20211008153232967.png)

- å¾ªç¯å›¾çš„èµ·ç‚¹æ˜¯â€œæŒ‡ä»¤å¯»å€â€ ---- å¾—åˆ°æŒ‡ä»¤çš„å†…å­˜åœ°å€
- ç„¶ååˆ°å†…å­˜é‡Œå–æŒ‡ä»¤ç 
- å†è§£ç æŒ‡ä»¤ï¼ŒæŠŠäºŒè¿›åˆ¶ç¿»è¯‘æˆæŒ‡ä»¤
- å¯»å€æºæ“ä½œæ•°
- ...

### å¦‚ä½•ç”¨Cè¯­è¨€æ¥æ¨¡æ‹Ÿè¯¥å¾ªç¯å¾€å¤çš„è¿‡ç¨‹å‘¢ï¼Ÿ

- whileå¾ªç¯æ¨¡æ‹Ÿ

![image-20211008153905545](PAè¯¾ç¬”è®°.assets/image-20211008153905545.png)

- å•æ¡æŒ‡ä»¤æ‰§è¡Œçš„å‡½æ•°

execå‡½æ•°çš„å…¥å£åœ¨single_runå‡½æ•°çš„ui_mainloopå‡½æ•°ä¸­

execå‡½æ•°çš„å…³é”®æ˜¯exec_instå‡½æ•°

- exec_instå‡½æ•°

![image-20211008154543381](PAè¯¾ç¬”è®°.assets/image-20211008154543381.png)

instr_fetchæœ¬è´¨æ˜¯è°ƒç”¨memory.vaddr_read()å‡½æ•°ï¼Œè¯»å†…å­˜



### æ€ä¹ˆçŸ¥é“opcodeå¯¹åº”å“ªæ¡æŒ‡ä»¤å‘¢ï¼Ÿ/ å•æ¡æŒ‡ä»¤çš„è§£ç 

- æŸ¥æ‰‹å†Œ
- ![image-20211008195422555](PAè¯¾ç¬”è®°.assets/image-20211008195422555.png)
- opcodeåˆ†ä¸ºå¾€å·¦çœ‹å’Œå¾€å³çœ‹ï¼Œå¦‚ğŸ‘†å›¾



### æŒ‡ä»¤çš„è§£ç è¿‡ç¨‹

- ä»EIPæŒ‡å‘çš„å­—èŠ‚å¼€å§‹çœ‹ï¼Œå…ˆçœ‹æ˜¯ä¸æ˜¯0x66ï¼Œä¹Ÿä¸æ˜¯0x0Fï¼Œè‹¥ä¸æ˜¯ï¼Œæ“ä½œæ•°32ä½ï¼Œ0x8bä¸ºæ“ä½œç 
- æŸ¥i386æ‰‹å†Œ
  - ![image-20211008200236887](PAè¯¾ç¬”è®°.assets/image-20211008200236887.png)
  - å³ä¸ºMOV Gv Evï¼ˆEvæ˜¯srcï¼Œ Gvæ˜¯destï¼‰
  - Gã€Eã€vçš„å…·ä½“å«ä¹‰å‚é˜…i386æ‰‹å†Œ
- ![image-20211008200924238](PAè¯¾ç¬”è®°.assets/image-20211008200924238.png)
  - ModR/Må­—èŠ‚ï¼ˆ8ä½ï¼‰å…·ä½“è§£æ
    - ![image-20211008200958087](PAè¯¾ç¬”è®°.assets/image-20211008200958087.png)
    - ç”±å‰ä¸€ä¸ªopcodeå†³å®šä¸­é—´3ä½æ˜¯regè¿˜æ˜¯opcodeã€‚æ ¹æ®Gvçš„è§£é‡Šï¼Œä¸­é—´ä¸‰ä½å–reg

- å†çœ‹ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼Œç„¶åæŸ¥i386è¡¨ï¼Œå¯ä»¥çŸ¥é“displacementï¼ˆdispï¼‰æ˜¯å¦å­˜åœ¨
  - ![image-20211008204030249](PAè¯¾ç¬”è®°.assets/image-20211008204030249.png)
  - å¯„å­˜å™¨æœ‰æ–¹æ‹¬å·è¡¨ç¤ºå†…å­˜åœ°å€å¯»å€ï¼Œå¦åˆ™è¡¨ç¤ºå¯„å­˜å™¨å¯»å€
  - [--] [--]
    - ![image-20211008204132473](PAè¯¾ç¬”è®°.assets/image-20211008204132473.png)
    - SIBå­—èŠ‚ç»“æ„
    - ![image-20211008204256480](PAè¯¾ç¬”è®°.assets/image-20211008204256480.png)

PSï¼šgprè¡¨ç¤ºé€šç”¨å¯„å­˜å™¨

- ![image-20211008204909221](PAè¯¾ç¬”è®°.assets/image-20211008204909221.png)	

Sibå¯»å€æ–¹å¼å°±ç±»ä¼¼äºåœ¨æ•°ç»„å‹æ•°æ®ç»“æ„é‡Œå¯»å€ï¼Œæ•°ç»„çš„é¦–åœ°å€æ”¾åœ¨baseé‡Œï¼Œå…ƒç´ ä¸‹æ ‡æ”¾åœ¨indexä¸­ï¼Œè€Œ$2^{ss}$å³ä¸º$sizeof(ADT)$

- è§£æå®Œæˆ

- ![image-20211008205337500](PAè¯¾ç¬”è®°.assets/image-20211008205337500.png)
- æ— 0x66çŸ¥é“çš„movåç¼€ä¸ºl
- reg fieldçŸ¥é“destæ˜¯%edx
- sibå’Œmodr/mçŸ¥é“ä¸­é—´çš„srcåŠè¿ç®—æ–¹å¼



æœ‰æ—¶è¿˜ä¼šé‡åˆ°grpï¼ˆgroupï¼‰æŒ‡ä»¤

![image-20211008205828152](PAè¯¾ç¬”è®°.assets/image-20211008205828152.png)

æ‰¾åˆ°groupxï¼Œ ç„¶åæ ¹æ®modR/Mçš„ä¸­é—´ä¸‰ä½æ¥åŒºåˆ†groupä¸­æ˜¯å“ªæ¡çš„ã€‚



opcodeçš„è§£ç ï¼š

- ç›´æ¥åœ¨æ•°ç»„é‡Œé¢å–
- åŒå­—èŠ‚æ“ä½œç 
- groupæ“ä½œç 



æ³¨ï¼šiï¼šç«‹å³æ•°ï¼›rmï¼šregister/memory



#### æ¨¡æ‹ŸmovæŒ‡ä»¤å‡½æ•°

![image-20211011173311610](PAè¯¾ç¬”è®°.assets/image-20211011173311610.png)

å…¶å®ä¹‹åçš„å‡½æ•°ä¹Ÿå¤§åŒå°å¼‚

æ¯”å¦‚è¯´å¦‚æœæ¨¡æ‹Ÿadd çš„è¯ï¼Œåªéœ€è¦æ”¹â‘¡å—çš„ä»£ç ï¼ˆè°ƒç”¨alu.addï¼Œå¹¶ç”¨r/m.valæ¥å—è¿”å›å€¼ )
